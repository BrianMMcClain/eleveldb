%% -*- mode: erlang; erlang-indent-level: 4; indent-tabs-mode: nil -*-
%% -------------------------------------------------------------------
%%
%% Copyright (c) 2011-2016 Basho Technologies, Inc.
%%
%% This file is provided to you under the Apache License,
%% Version 2.0 (the "License"); you may not use this file
%% except in compliance with the License.  You may obtain
%% a copy of the License at
%%
%%   http://www.apache.org/licenses/LICENSE-2.0
%%
%% Unless required by applicable law or agreed to in writing,
%% software distributed under the License is distributed on an
%% "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
%% KIND, either express or implied.  See the License for the
%% specific language governing permissions and limitations
%% under the License.
%%
%% -------------------------------------------------------------------

%% Store most everything locally rather than in $HOME

{global_rebar_dir,  ".cache"}.
{dialyzer,  [
    {base_plt_location, ".cache"},
    {plt_location,      ".cache"}
]}.

%% Global Erlang compile options, more in profiles

{erl_opts,  [
    debug_info,
    % no_auto_import,
    warn_export_vars,
    warn_unused_import
]}.

%% Dependencies

{plugins,   [
    {rebar_raw_resource,
        {git, "git://github.com/tburghart/rebar_raw_resource.git",
              {branch, "master"}}}
]}.

{deps,  [
    % development only, this will be included at a higher level when productized
    {leveldb_ee, {raw, {git, "git@github.com:basho/leveldb_ee.git", {branch, "develop"}}}},

    {cuttlefish,    {git, "git://github.com/basho/cuttlefish.git",  {branch, "develop"}} },
    {leveldb, {raw, {git, "git://github.com/basho/leveldb.git",     {branch, "develop"}}}},
    {snappy,  {raw, {git, "git://github.com/google/snappy.git",     {branch, "master" }}}}
]}.

{pre_hooks, [
    {"(linux|darwin|solaris)",  compile,    "make  -C tools dist"},
    {"(freebsd)",               compile,    "gmake -C tools dist"},
    {"(linux|darwin|solaris)",  clean,      "make  -C tools clean-dist"},
    {"(freebsd)",               clean,      "gmake -C tools clean-dist"}
]}.

%% Profiles to narrow things down

{profiles,  [
    {prod,  [
        {erl_opts,  [
            warn_export_all,
            warn_obsolete_guard,
            warnings_as_errors
        ]}
    ]},

    {test,  [
        {erl_opts,  [
            debug_info,
            nowarn_deprecated_function
        ]}
    ]},

    {check, [
        {erl_opts,  [
            debug_info,
            warn_export_all,
            warn_obsolete_guard
        ]},

        {eunit_opts,    [
            verbose
        ]},

        {xref_checks,   [
            deprecated_function_calls,
            deprecated_functions,
            locals_not_used,
            undefined_function_calls,
            undefined_functions
        ]}
    ]}
]}.

